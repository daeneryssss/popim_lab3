"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{4617:function(e,t,r){r.r(t),r.d(t,{__experimental_Checkout:()=>Z});var i=r(8635),o=r(8756),n=r(3064),a=r(6106),l=r(4229),s=r(9140),c=r(6258),u=r(43);let d=e=>e[0].toUpperCase()+e.slice(1),m=({checkout:e})=>{let{setIsOpen:t}=(0,a.useDrawerContext)();return(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Drawer.Body,{children:(0,i.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0}),children:[(0,i.tZ)(p,{scale:1}),(0,i.tZ)(p,{scale:.75}),(0,i.tZ)(p,{scale:.5}),(0,i.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:(0,i.tZ)(n.Icon,{icon:c.Jr,colorScheme:"neutral",sx:{position:"relative",margin:"auto"},"aria-hidden":!0})}),(0,i.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,i.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:e.subscription?.status==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.title__subscriptionSuccessful")}),(0,i.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2}),localizationKey:e.subscription?.status==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,i.BX)(a.Drawer.Footer,{sx:e=>({rowGap:e.space.$4}),children:[(0,i.BX)(a.LineItems.Root,{children:[(0,i.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,i.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__totalPaid")}),(0,i.tZ)(a.LineItems.Description,{text:`${e.totals.totalDueNow.currencySymbol}${e.totals.totalDueNow.amountFormatted}`})]}),(0,i.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,i.tZ)(a.LineItems.Title,{title:e.subscription?.status==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__subscriptionBegins")}),(0,i.tZ)(a.LineItems.Description,{text:e.subscription?.status==="active"?e.paymentSource?`${d(e.paymentSource.cardType)} ⋯ ${e.paymentSource.last4}`:"–":e.subscription?.periodStart?(0,u.p6)(new Date(e.subscription.periodStart)):"–"})]}),(0,i.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__invoiceId")}),(0,i.tZ)(a.LineItems.Description,{text:e.invoice_id||"–",truncateText:!0,copyText:!0,copyLabel:"Copy invoice ID"})]})]}),(0,i.tZ)(n.Button,{onClick:()=>{t&&t(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]})};function p({scale:e}){return(0,i.tZ)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRing,sx:t=>({margin:"auto",gridArea:"1/1",width:`${100*e}%`,height:`${100*e}%`,borderWidth:1,borderStyle:"solid",borderColor:t.colors.$neutralAlpha200,borderRadius:t.radii.$circle,maskImage:"linear-gradient(to bottom, transparent 15%, black, transparent 85%)"})})}var h=r(3799),y=r(9144),f=r(1201),g=r(4011);let b=e=>e[0].toUpperCase()+e.slice(1),S=({checkout:e,onCheckoutComplete:t})=>{let{plan:r,planPeriod:o,totals:l,isImmediatePlanChange:s}=e,c=l.totalDueNow.amount>0&&!!l.proration?.credit?.amount&&l.proration.credit.amount>0,u=!s;return(0,i.BX)(a.Drawer.Body,{children:[(0,i.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,i.BX)(a.LineItems.Root,{children:[u&&(0,i.tZ)(n.Span,{localizationKey:"Your features will remain until the end of your current subscription.",elementDescriptor:n.descriptors.lineItemsDowngradeNotice,sx:e=>({fontSize:e.fontSizes.$sm,color:e.colors.$colorTextSecondary})}),(0,i.BX)(a.LineItems.Group,{borderTop:u,children:[(0,i.tZ)(a.LineItems.Title,{title:r.name}),(0,i.tZ)(a.LineItems.Description,{text:`${r.currencySymbol}${"month"===o?r.amountFormatted:r.annualMonthlyAmountFormatted}`,suffix:`per month${"annual"===o?", times 12 months":""}`})]}),c&&(0,i.BX)(a.LineItems.Group,{children:[(0,i.tZ)(a.LineItems.Title,{title:"Credit",description:"Prorated credit for the remainder of your subscription."}),(0,i.tZ)(a.LineItems.Description,{text:`- ${l.proration?.credit.currencySymbol}${l.proration?.credit.amountFormatted}`})]}),(0,i.BX)(a.LineItems.Group,{borderTop:!0,variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:"Subtotal"}),(0,i.tZ)(a.LineItems.Description,{text:`${l.subtotal.currencySymbol} ${l.subtotal.amountFormatted}`})]}),(0,i.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:"Tax"}),(0,i.tZ)(a.LineItems.Description,{text:`${l.taxTotal.currencySymbol} ${l.taxTotal.amountFormatted}`})]}),(0,i.BX)(a.LineItems.Group,{borderTop:!0,children:[(0,i.tZ)(a.LineItems.Title,{title:"Total Due Today"}),(0,i.tZ)(a.LineItems.Description,{text:`${l.totalDueNow.currencySymbol}${l.totalDueNow.amountFormatted}`})]})]})}),(0,i.tZ)(_,{checkout:e,onCheckoutComplete:t})]})},_=({checkout:e,onCheckoutComplete:t})=>{let{__experimental_commerce:r}=(0,h.cL)(),{user:s}=(0,h.aF)(),{organization:c}=(0,h.o8)(),{subscriberType:d}=(0,o.useCheckoutContext)(),[m,p]=(0,y.useState)("existing"),[f,b]=(0,y.useState)(!1),[S,_]=(0,y.useState)(),{data:B,revalidate:Z}=(0,l.ib)(r?.getPaymentSources,{..."org"===d?{orgId:c?.id}:{}},void 0,`commerce-payment-sources-${s?.id}`),{data:k}=B||{data:[]};(0,y.useEffect)(()=>{p(k.length>0?"existing":"new")},[k]);let C=async r=>{try{let i=await e.confirm({...r,..."org"===d?{orgId:c?.id}:{}});t(i)}catch(e){(0,u.S3)(e,[],_)}},v=async e=>{e.preventDefault(),b(!0),_(void 0);let t=new FormData(e.currentTarget).get("payment_source_id");await C({paymentSourceId:t,..."org"===d?{orgId:c?.id}:{}}),b(!1)},w=async e=>{Z(),await C({gateway:"stripe",paymentToken:e.stripeSetupIntent?.payment_method,..."org"===d?{orgId:c?.id}:{}}),b(!1)};return(0,i.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[k.length>0&&e.totals.totalDueNow.amount>0&&(0,i.BX)(a.SegmentedControl.Root,{"aria-label":"Payment method source",value:m,onChange:e=>p(e),size:"lg",fullWidth:!0,children:[(0,i.tZ)(a.SegmentedControl.Button,{value:"existing",text:"Payment Methods"}),(0,i.tZ)(a.SegmentedControl.Button,{value:"new",text:"Add payment method"})]}),"existing"===m&&(0,i.tZ)(x,{checkout:e,paymentSources:k,totalDueNow:e.totals.totalDueNow,onPaymentSourceSubmit:v,isSubmitting:f,submitError:S}),"new"===m&&(0,i.tZ)(g.M$,{checkout:e,onSuccess:w,submitLabel:e.totals.totalDueNow.amount>0?(0,n.localizationKeys)("userProfile.__experimental_billingPage.paymentSourcesSection.formButtonPrimary__pay",{amount:`${e.totals.totalDueNow.currencySymbol}${e.totals.totalDueNow.amountFormatted}`}):"Subscribe",submitError:S,setSubmitError:_})]})},x=({checkout:e,totalDueNow:t,paymentSources:r,onPaymentSourceSubmit:o,isSubmitting:l,submitError:s})=>{let[u,d]=(0,y.useState)(e.paymentSource||r.find(e=>e.isDefault)),m=(0,y.useMemo)(()=>r.map(e=>({value:e.id,label:`${b(e.cardType)} ⋯ ${e.last4}`})),[r]);return(0,i.BX)(n.Form,{onSubmit:o,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[e.totals.totalDueNow.amount>0?(0,i.BX)(a.Select,{elementId:"paymentSource",options:m,value:u?.id||null,onChange:e=>{d(r.find(t=>t.id===e.value))},portal:!0,children:[(0,i.tZ)("input",{name:"payment_source_id",type:"hidden",value:u?.id}),(0,i.tZ)(a.SelectButton,{icon:c.OG,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:u&&(0,i.tZ)(g.jr,{paymentSource:u})}),(0,i.tZ)(a.SelectOptionList,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,i.tZ)("input",{name:"payment_source_id",type:"hidden",value:u?.id}),s&&(0,i.tZ)(a.Alert,{variant:"danger",sx:e=>({animation:`${f.animations.textInBig} ${e.transitionDuration.$slow}`}),children:"string"==typeof s?s:s.message}),(0,i.tZ)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:l,children:t.amount>0?(0,i.BX)(i.HY,{children:["Pay ",t.currencySymbol,t.amountFormatted]}):"Subscribe"})]})},B=e=>{let{planId:t,planPeriod:r,subscriberType:o,onSubscriptionComplete:c}=e,{setIsOpen:u}=(0,a.useDrawerContext)(),{checkout:d,isLoading:p,invalidate:h,revalidate:y,updateCheckout:f,isMissingPayerEmail:g}=(0,l.Mg)({planId:t,planPeriod:r,subscriberType:o});return p?(0,i.tZ)(n.Spinner,{sx:{margin:"auto"}}):d?d?.status==="completed"?(0,i.tZ)(m,{checkout:d}):(0,i.tZ)(S,{checkout:d,onCheckoutComplete:e=>{h(),f(e),c?.()}}):g?(0,i.tZ)(a.Drawer.Body,{children:(0,i.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,i.tZ)(s._,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.emailForm.title"),subtitle:(0,n.localizationKeys)("__experimental_commerce.checkout.emailForm.subtitle"),onSuccess:y,onReset:()=>u(!1),disableAutoFocus:!0})})}):(0,i.tZ)(i.HY,{children:(0,i.tZ)(n.Alert,{colorScheme:"danger",sx:{margin:"auto"},children:"There was a problem, please try again later."})})},Z=e=>(0,i.tZ)(n.Flow.Root,{flow:"checkout",children:(0,i.tZ)(n.Flow.Part,{children:(0,i.tZ)(o.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,i.tZ)(o.__experimental_CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,i.BX)(a.Drawer.Content,{children:[(0,i.tZ)(a.Drawer.Header,{title:"Checkout"}),(0,i.tZ)(B,{...e})]})})})})})},9140:function(e,t,r){r.d(t,{_:()=>b});var i=r(8635),o=r(3799),n=r(9144),a=r(8969),l=r(8756),s=r(6106),c=r(1085),u=r(43),d=r(207),m=r(4676),p=r(6917),h=r(3064),y=r(4229);let f=e=>{let{navigate:t}=(0,m.useRouter)(),{email:r,nextStep:o,onReset:a}=e,c=(0,s.useCardState)(),d=(0,l.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:f}=(0,y.eq)(r);async function g(){await t(r.verification.externalVerificationRedirectURL?.href||"")}return n.useEffect(()=>{!function(){let{mode:e,componentName:t}=d;f({redirectUrl:"modal"===e?(0,p.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>o()).catch(e=>(0,u.S3)(e,[],c.setError))}()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(h.Flex,{justify:"center",children:(0,i.tZ)(h.Button,{variant:"link",onClick:g,localizationKey:(0,h.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,i.tZ)(s.FormButtonContainer,{children:(0,i.tZ)(h.Button,{variant:"ghost",localizationKey:(0,h.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:h.descriptors.formButtonReset,onClick:a})})]})};var g=r(2786);let b=(0,s.withCardStateProvider)(e=>{let{emailId:t,onSuccess:r,onReset:m,disableAutoFocus:p=!1}=e,h=(0,s.useCardState)(),{user:y}=(0,o.aF)(),b=(0,l.useEnvironment)(),x=(0,o.WZ)(e=>y?.createEmailAddress({email:e})),B=n.useRef(y?.emailAddresses.find(e=>e.id===t)),Z=_(B.current,b),k=(0,a.a2)({defaultStep:+!!B.current,onNextStep:()=>h.setError(void 0)}),C=(0,u.Yp)("emailAddress","",{type:"email",label:(0,c.u1)("formFieldLabel__emailAddress"),placeholder:(0,c.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),v=C.value.length>1&&y?.username!==C.value,w=async e=>{if(e.preventDefault(),y)return x(C.value).then(e=>{B.current=e,k.nextStep()}).catch(e=>(0,u.S3)(e,[C],h.setError))},$=S(Z);return(0,i.BX)(a.en,{...k.props,children:[(0,i.tZ)(s.FormContainer,{headerTitle:e.title||(0,c.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,c.u1)("userProfile.emailAddressPage.formHint"),children:(0,i.BX)(s.Form.Root,{onSubmit:w,children:[(0,i.tZ)(s.Form.ControlRow,{elementId:C.id,children:(0,i.tZ)(s.Form.PlainInput,{...C.props,autoFocus:!p})}),(0,i.tZ)(s.FormButtons,{submitLabel:(0,c.u1)("userProfile.formButtonPrimary__add"),isDisabled:!v,onReset:m})]})}),(0,i.BX)(s.FormContainer,{headerTitle:(0,c.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,c.u1)(`${$}.formSubtitle`,{identifier:B.current?.emailAddress}),children:["email_link"===Z&&(0,i.tZ)(g.K,{nextStep:r,email:B.current,onReset:m}),"email_code"===Z&&(0,i.tZ)(d.H,{nextStep:r,identification:B.current,identifier:B.current?.emailAddress,prepareVerification:()=>B.current?.prepareVerification({strategy:"email_code"}),onReset:m}),"enterprise_sso"===Z&&(0,i.tZ)(f,{nextStep:r,email:B.current,onReset:m})]})]})}),S=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},_=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:r}=t.attributes;return!!(r?.enabled&&r?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,r){r.d(t,{H:()=>s});var i=r(8635),o=r(9144),n=r(3064),a=r(6106),l=r(43);let s=e=>{let t=(0,a.useCardState)(),{nextStep:r,identification:s,identifier:c,onReset:u,prepareVerification:d}=e,m=()=>d?.()?.catch(e=>l.S3(e,[],t.setError)),p=(0,a.useFieldOTP)({onCodeEntryFinished:(e,t,r)=>{s?.attemptVerification({code:e}).then(()=>t()).catch(r)},onResendCodeClicked:m,onResolve:r});return o.useEffect(()=>{m()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Form.OTPInput,{...p,label:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:c}),resendButton:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,i.BX)(a.FormButtonContainer,{children:[(0,i.tZ)(n.Button,{isLoading:p.isLoading,localizationKey:(0,n.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:n.descriptors.formButtonPrimary,onClick:p.onFakeContinue}),(0,i.tZ)(n.Button,{variant:"ghost",isDisabled:p.isLoading,localizationKey:(0,n.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:n.descriptors.formButtonReset,onClick:u})]})]})}},2786:function(e,t,r){r.d(t,{K:()=>m,M:()=>p});var i=r(8635),o=r(9144),n=r(8969),a=r(6749),l=r(8756),s=r(3064),c=r(6106),u=r(4229),d=r(43);let m=e=>{let{email:t,nextStep:r,onReset:n}=e,m=(0,c.useCardState)(),p=(0,l.useUserProfileContext)(),{startEmailLinkFlow:h}=(0,u.E2)(t),{displayConfig:y}=(0,l.useEnvironment)();function f(){let{routing:e}=p,t="virtual"===e?y.userProfileUrl:"";h({redirectUrl:(0,a.Uu)({ctx:p,baseUrl:t,intent:"profile"})}).then(()=>r()).catch(e=>(0,d.S3)(e,[],m.setError))}return o.useEffect(()=>{f()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(c.VerificationLink,{resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:f}),(0,i.tZ)(c.FormButtonContainer,{children:(0,i.tZ)(s.Button,{variant:"ghost",localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:n})})]})},p=()=>(0,i.tZ)(n.Ej,{title:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,s.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);
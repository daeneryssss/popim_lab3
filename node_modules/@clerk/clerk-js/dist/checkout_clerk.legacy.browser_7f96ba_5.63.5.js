"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{24617:function(e,t,o){o.r(t),o.d(t,{__experimental_Checkout:()=>B});var i=o(88635),r=o(8756),n=o(43064),a=o(30948),l=o(34229),c=o(99140),s=o(96258),u=o(50043);let d=e=>e[0].toUpperCase()+e.slice(1),m=e=>{var t,o,r,l,c;let{checkout:m}=e,{setIsOpen:h}=(0,a.useDrawerContext)();return(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Drawer.Body,{children:(0,i.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0}),children:[(0,i.tZ)(p,{scale:1}),(0,i.tZ)(p,{scale:.75}),(0,i.tZ)(p,{scale:.5}),(0,i.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:(0,i.tZ)(n.Icon,{icon:s.Jr,colorScheme:"neutral",sx:{position:"relative",margin:"auto"},"aria-hidden":!0})}),(0,i.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:"translateY(".concat(e.space.$20,")")}),children:[(0,i.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:(null===(t=m.subscription)||void 0===t?void 0:t.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.title__subscriptionSuccessful")}),(0,i.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2}),localizationKey:(null===(o=m.subscription)||void 0===o?void 0:o.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("__experimental_commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,i.BX)(a.Drawer.Footer,{sx:e=>({rowGap:e.space.$4}),children:[(0,i.BX)(a.LineItems.Root,{children:[(0,i.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,i.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__totalPaid")}),(0,i.tZ)(a.LineItems.Description,{text:"".concat(m.totals.totalDueNow.currencySymbol).concat(m.totals.totalDueNow.amountFormatted)})]}),(0,i.BX)(a.LineItems.Group,{variant:"secondary",children:[(0,i.tZ)(a.LineItems.Title,{title:(null===(r=m.subscription)||void 0===r?void 0:r.status)==="active"?(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__subscriptionBegins")}),(0,i.tZ)(a.LineItems.Description,{text:(null===(l=m.subscription)||void 0===l?void 0:l.status)==="active"?m.paymentSource?"".concat(d(m.paymentSource.cardType)," ⋯ ").concat(m.paymentSource.last4):"–":(null===(c=m.subscription)||void 0===c?void 0:c.periodStart)?(0,u.p6)(new Date(m.subscription.periodStart)):"–"})]}),(0,i.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.lineItems.title__invoiceId")}),(0,i.tZ)(a.LineItems.Description,{text:m.invoice_id||"–",truncateText:!0,copyText:!0,copyLabel:"Copy invoice ID"})]})]}),(0,i.tZ)(n.Button,{onClick:()=>{h&&h(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]})};function p(e){let{scale:t}=e;return(0,i.tZ)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRing,sx:e=>({margin:"auto",gridArea:"1/1",width:"".concat(100*t,"%"),height:"".concat(100*t,"%"),borderWidth:1,borderStyle:"solid",borderColor:e.colors.$neutralAlpha200,borderRadius:e.radii.$circle,maskImage:"linear-gradient(to bottom, transparent 15%, black, transparent 85%)"})})}o(65223);var h=o(83799),y=o(69144),v=o(81201),f=o(64011);let g=e=>e[0].toUpperCase()+e.slice(1),b=e=>{var t,o,r,l;let{checkout:c,onCheckoutComplete:s}=e,{plan:u,planPeriod:d,totals:m,isImmediatePlanChange:p}=c,h=m.totalDueNow.amount>0&&!!(null===(o=m.proration)||void 0===o?void 0:null===(t=o.credit)||void 0===t?void 0:t.amount)&&m.proration.credit.amount>0,y=!p;return(0,i.BX)(a.Drawer.Body,{children:[(0,i.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,i.BX)(a.LineItems.Root,{children:[y&&(0,i.tZ)(n.Span,{localizationKey:"Your features will remain until the end of your current subscription.",elementDescriptor:n.descriptors.lineItemsDowngradeNotice,sx:e=>({fontSize:e.fontSizes.$sm,color:e.colors.$colorTextSecondary})}),(0,i.BX)(a.LineItems.Group,{borderTop:y,children:[(0,i.tZ)(a.LineItems.Title,{title:u.name}),(0,i.tZ)(a.LineItems.Description,{text:"".concat(u.currencySymbol).concat("month"===d?u.amountFormatted:u.annualMonthlyAmountFormatted),suffix:"per month".concat("annual"===d?", times 12 months":"")})]}),h&&(0,i.BX)(a.LineItems.Group,{children:[(0,i.tZ)(a.LineItems.Title,{title:"Credit",description:"Prorated credit for the remainder of your subscription."}),(0,i.tZ)(a.LineItems.Description,{text:"- ".concat(null===(r=m.proration)||void 0===r?void 0:r.credit.currencySymbol).concat(null===(l=m.proration)||void 0===l?void 0:l.credit.amountFormatted)})]}),(0,i.BX)(a.LineItems.Group,{borderTop:!0,variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:"Subtotal"}),(0,i.tZ)(a.LineItems.Description,{text:"".concat(m.subtotal.currencySymbol," ").concat(m.subtotal.amountFormatted)})]}),(0,i.BX)(a.LineItems.Group,{variant:"tertiary",children:[(0,i.tZ)(a.LineItems.Title,{title:"Tax"}),(0,i.tZ)(a.LineItems.Description,{text:"".concat(m.taxTotal.currencySymbol," ").concat(m.taxTotal.amountFormatted)})]}),(0,i.BX)(a.LineItems.Group,{borderTop:!0,children:[(0,i.tZ)(a.LineItems.Title,{title:"Total Due Today"}),(0,i.tZ)(a.LineItems.Description,{text:"".concat(m.totalDueNow.currencySymbol).concat(m.totalDueNow.amountFormatted)})]})]})}),(0,i.tZ)(S,{checkout:c,onCheckoutComplete:s})]})},S=e=>{let{checkout:t,onCheckoutComplete:o}=e,{__experimental_commerce:c}=(0,h.cL)(),{user:s}=(0,h.aF)(),{organization:d}=(0,h.o8)(),{subscriberType:m}=(0,r.useCheckoutContext)(),[p,v]=(0,y.useState)("existing"),[g,b]=(0,y.useState)(!1),[S,x]=(0,y.useState)(),{data:B,revalidate:Z}=(0,l.ib)(null==c?void 0:c.getPaymentSources,{..."org"===m?{orgId:null==d?void 0:d.id}:{}},void 0,"commerce-payment-sources-".concat(null==s?void 0:s.id)),{data:k}=B||{data:[]};(0,y.useEffect)(()=>{v(k.length>0?"existing":"new")},[k]);let C=async e=>{try{let i=await t.confirm({...e,..."org"===m?{orgId:null==d?void 0:d.id}:{}});o(i)}catch(e){(0,u.S3)(e,[],x)}},w=async e=>{e.preventDefault(),b(!0),x(void 0);let t=new FormData(e.currentTarget).get("payment_source_id");await C({paymentSourceId:t,..."org"===m?{orgId:null==d?void 0:d.id}:{}}),b(!1)},D=async e=>{var t;Z(),await C({gateway:"stripe",paymentToken:null===(t=e.stripeSetupIntent)||void 0===t?void 0:t.payment_method,..."org"===m?{orgId:null==d?void 0:d.id}:{}}),b(!1)};return(0,i.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[k.length>0&&t.totals.totalDueNow.amount>0&&(0,i.BX)(a.SegmentedControl.Root,{"aria-label":"Payment method source",value:p,onChange:e=>v(e),size:"lg",fullWidth:!0,children:[(0,i.tZ)(a.SegmentedControl.Button,{value:"existing",text:"Payment Methods"}),(0,i.tZ)(a.SegmentedControl.Button,{value:"new",text:"Add payment method"})]}),"existing"===p&&(0,i.tZ)(_,{checkout:t,paymentSources:k,totalDueNow:t.totals.totalDueNow,onPaymentSourceSubmit:w,isSubmitting:g,submitError:S}),"new"===p&&(0,i.tZ)(f.M$,{checkout:t,onSuccess:D,submitLabel:t.totals.totalDueNow.amount>0?(0,n.localizationKeys)("userProfile.__experimental_billingPage.paymentSourcesSection.formButtonPrimary__pay",{amount:"".concat(t.totals.totalDueNow.currencySymbol).concat(t.totals.totalDueNow.amountFormatted)}):"Subscribe",submitError:S,setSubmitError:x})]})},_=e=>{let{checkout:t,totalDueNow:o,paymentSources:r,onPaymentSourceSubmit:l,isSubmitting:c,submitError:u}=e,[d,m]=(0,y.useState)(t.paymentSource||r.find(e=>e.isDefault)),p=(0,y.useMemo)(()=>r.map(e=>({value:e.id,label:"".concat(g(e.cardType)," ⋯ ").concat(e.last4)})),[r]);return(0,i.BX)(n.Form,{onSubmit:l,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[t.totals.totalDueNow.amount>0?(0,i.BX)(a.Select,{elementId:"paymentSource",options:p,value:(null==d?void 0:d.id)||null,onChange:e=>{m(r.find(t=>t.id===e.value))},portal:!0,children:[(0,i.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==d?void 0:d.id}),(0,i.tZ)(a.SelectButton,{icon:s.OG,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:d&&(0,i.tZ)(f.jr,{paymentSource:d})}),(0,i.tZ)(a.SelectOptionList,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,i.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==d?void 0:d.id}),u&&(0,i.tZ)(a.Alert,{variant:"danger",sx:e=>({animation:"".concat(v.animations.textInBig," ").concat(e.transitionDuration.$slow)}),children:"string"==typeof u?u:u.message}),(0,i.tZ)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:c,children:o.amount>0?(0,i.BX)(i.HY,{children:["Pay ",o.currencySymbol,o.amountFormatted]}):"Subscribe"})]})},x=e=>{let{planId:t,planPeriod:o,subscriberType:r,onSubscriptionComplete:s}=e,{setIsOpen:u}=(0,a.useDrawerContext)(),{checkout:d,isLoading:p,invalidate:h,revalidate:y,updateCheckout:v,isMissingPayerEmail:f}=(0,l.Mg)({planId:t,planPeriod:o,subscriberType:r});return p?(0,i.tZ)(n.Spinner,{sx:{margin:"auto"}}):d?(null==d?void 0:d.status)==="completed"?(0,i.tZ)(m,{checkout:d}):(0,i.tZ)(b,{checkout:d,onCheckoutComplete:e=>{h(),v(e),null==s||s()}}):f?(0,i.tZ)(a.Drawer.Body,{children:(0,i.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,i.tZ)(c._,{title:(0,n.localizationKeys)("__experimental_commerce.checkout.emailForm.title"),subtitle:(0,n.localizationKeys)("__experimental_commerce.checkout.emailForm.subtitle"),onSuccess:y,onReset:()=>u(!1),disableAutoFocus:!0})})}):(0,i.tZ)(i.HY,{children:(0,i.tZ)(n.Alert,{colorScheme:"danger",sx:{margin:"auto"},children:"There was a problem, please try again later."})})},B=e=>(0,i.tZ)(n.Flow.Root,{flow:"checkout",children:(0,i.tZ)(n.Flow.Part,{children:(0,i.tZ)(r.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,i.tZ)(r.__experimental_CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,i.BX)(a.Drawer.Content,{children:[(0,i.tZ)(a.Drawer.Header,{title:"Checkout"}),(0,i.tZ)(x,{...e})]})})})})})},99140:function(e,t,o){o.d(t,{_:()=>g}),o(92037),o(28419);var i=o(88635),r=o(83799),n=o(69144),a=o(8969),l=o(8756),c=o(30948),s=o(91085),u=o(50043),d=o(10207);o(50725);var m=o(24676),p=o(26917),h=o(43064),y=o(34229);let v=e=>{let{navigate:t}=(0,m.useRouter)(),{email:o,nextStep:r,onReset:a}=e,s=(0,c.useCardState)(),d=(0,l.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:v}=(0,y.eq)(o);async function f(){var e;await t((null===(e=o.verification.externalVerificationRedirectURL)||void 0===e?void 0:e.href)||"")}return n.useEffect(()=>{!function(){let{mode:e,componentName:t}=d;v({redirectUrl:"modal"===e?(0,p.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>r()).catch(e=>(0,u.S3)(e,[],s.setError))}()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(h.Flex,{justify:"center",children:(0,i.tZ)(h.Button,{variant:"link",onClick:f,localizationKey:(0,h.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,i.tZ)(c.FormButtonContainer,{children:(0,i.tZ)(h.Button,{variant:"ghost",localizationKey:(0,h.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:h.descriptors.formButtonReset,onClick:a})})]})};var f=o(12786);let g=(0,c.withCardStateProvider)(e=>{var t,o;let{emailId:m,onSuccess:p,onReset:h,disableAutoFocus:y=!1}=e,g=(0,c.useCardState)(),{user:_}=(0,r.aF)(),x=(0,l.useEnvironment)(),B=(0,r.WZ)(e=>null==_?void 0:_.createEmailAddress({email:e})),Z=n.useRef(null==_?void 0:_.emailAddresses.find(e=>e.id===m)),k=S(Z.current,x),C=(0,a.a2)({defaultStep:+!!Z.current,onNextStep:()=>g.setError(void 0)}),w=(0,u.Yp)("emailAddress","",{type:"email",label:(0,s.u1)("formFieldLabel__emailAddress"),placeholder:(0,s.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),D=w.value.length>1&&(null==_?void 0:_.username)!==w.value,P=async e=>{if(e.preventDefault(),_)return B(w.value).then(e=>{Z.current=e,C.nextStep()}).catch(e=>(0,u.S3)(e,[w],g.setError))},I=b(k);return(0,i.BX)(a.en,{...C.props,children:[(0,i.tZ)(c.FormContainer,{headerTitle:e.title||(0,s.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,s.u1)("userProfile.emailAddressPage.formHint"),children:(0,i.BX)(c.Form.Root,{onSubmit:P,children:[(0,i.tZ)(c.Form.ControlRow,{elementId:w.id,children:(0,i.tZ)(c.Form.PlainInput,{...w.props,autoFocus:!y})}),(0,i.tZ)(c.FormButtons,{submitLabel:(0,s.u1)("userProfile.formButtonPrimary__add"),isDisabled:!D,onReset:h})]})}),(0,i.BX)(c.FormContainer,{headerTitle:(0,s.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,s.u1)("".concat(I,".formSubtitle"),{identifier:null===(t=Z.current)||void 0===t?void 0:t.emailAddress}),children:["email_link"===k&&(0,i.tZ)(f.K,{nextStep:p,email:Z.current,onReset:h}),"email_code"===k&&(0,i.tZ)(d.H,{nextStep:p,identification:Z.current,identifier:null===(o=Z.current)||void 0===o?void 0:o.emailAddress,prepareVerification:()=>{var e;return null===(e=Z.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:h}),"enterprise_sso"===k&&(0,i.tZ)(v,{nextStep:p,email:Z.current,onReset:h})]})]})}),b=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error("Unsupported strategy for email verification: ".concat(e))}},S=(e,t)=>(null==e?void 0:e.matchesSsoConnection)?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:o}=t.attributes;return!!((null==o?void 0:o.enabled)&&(null==o?void 0:o.verifications.includes("email_link")))}(t)?"email_code":"email_link"},10207:function(e,t,o){o.d(t,{H:()=>c});var i=o(88635),r=o(69144),n=o(43064),a=o(30948),l=o(50043);let c=e=>{let t=(0,a.useCardState)(),{nextStep:o,identification:c,identifier:s,onReset:u,prepareVerification:d}=e,m=()=>{var e;return null==d?void 0:null===(e=d())||void 0===e?void 0:e.catch(e=>(0,l.S3)(e,[],t.setError))},p=(0,a.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{null==c||c.attemptVerification({code:e}).then(()=>t()).catch(o)},onResendCodeClicked:m,onResolve:o});return r.useEffect(()=>{m()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Form.OTPInput,{...p,label:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:s}),resendButton:(0,n.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,i.BX)(a.FormButtonContainer,{children:[(0,i.tZ)(n.Button,{isLoading:p.isLoading,localizationKey:(0,n.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:n.descriptors.formButtonPrimary,onClick:p.onFakeContinue}),(0,i.tZ)(n.Button,{variant:"ghost",isDisabled:p.isLoading,localizationKey:(0,n.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:n.descriptors.formButtonReset,onClick:u})]})]})}},12786:function(e,t,o){o.d(t,{K:()=>m,M:()=>p});var i=o(88635),r=o(69144),n=o(8969),a=o(56749),l=o(8756),c=o(43064),s=o(30948),u=o(34229),d=o(50043);let m=e=>{let{email:t,nextStep:o,onReset:n}=e,m=(0,s.useCardState)(),p=(0,l.useUserProfileContext)(),{startEmailLinkFlow:h}=(0,u.E2)(t),{displayConfig:y}=(0,l.useEnvironment)();function v(){let{routing:e}=p,t="virtual"===e?y.userProfileUrl:"";h({redirectUrl:(0,a.Uu)({ctx:p,baseUrl:t,intent:"profile"})}).then(()=>o()).catch(e=>(0,d.S3)(e,[],m.setError))}return r.useEffect(()=>{v()},[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(s.VerificationLink,{resendButton:(0,c.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:v}),(0,i.tZ)(s.FormButtonContainer,{children:(0,i.tZ)(c.Button,{variant:"ghost",localizationKey:(0,c.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:c.descriptors.formButtonReset,onClick:n})})]})},p=()=>(0,i.tZ)(n.Ej,{title:(0,c.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,c.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);